import{d as a,r as e,j as l,k as r,a as o,l as s,o as t,c as i,h as n,e as u,w as c,i as d,f as m,t as v,F as p,u as g}from"./index-DOZqpDgu.js";import{a as f}from"./api-O7hkGn9P.js";const y={class:"text-caption"},b={class:"d-flex gap-2"},_={class:"pa-6 text-center"},h=a({__name:"UsersList",props:{searchTerm:{}},setup(a){const g=a,h=e([]),A=e(!1),w=e(null),k=e(!1),E=e({}),x=e(null),C=l(()=>"admin"===x.value?.rol),U=[{title:"Nombre",value:"nombre"},{title:"Email",value:"email"},{title:"Rol",value:"rol"},{title:"Fecha de Creación",value:"created_at"},{title:"Acciones",value:"actions",sortable:!1}];r(()=>{const a=localStorage.getItem("user");x.value=a?JSON.parse(a):null,(async()=>{A.value=!0;try{const a=await f.get("/usuarios");console.log("🔍 DEBUG - Respuesta completa:",a),console.log("🔍 DEBUG - Datos recibidos:",a.data),console.log("🔍 DEBUG - Tipo de datos:",typeof a.data),console.log("🔍 DEBUG - Es array?",Array.isArray(a.data)),console.log("🔍 DEBUG - Keys del objeto:",a.data?Object.keys(a.data):"N/A");let e=[];const l=a.data;Array.isArray(l)?(e=l,console.log("✅ Formato directo - Array de usuarios")):l&&Array.isArray(l.data)?(e=l.data,console.log("✅ Formato encapsulado - response.data.data")):l&&Array.isArray(l.users)?(e=l.users,console.log("✅ Formato con clave users - response.data.users")):(console.warn("⚠️ Formato de API no reconocido:",l),e=[]),console.log("🎯 Usuarios finales a mostrar:",e),h.value=e,E.value={rawResponse:a,dataReceived:l,dataType:typeof l,isArray:Array.isArray(l),finalUsers:e,finalCount:e.length}}catch(a){console.error("❌ Error al cargar usuarios:",a),h.value=[]}finally{A.value=!1}})()});const D=a=>{if(!a)return"-";return new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},I=l(()=>{const a=(g.searchTerm||"").toLowerCase().trim(),e=Array.isArray(h.value)?h.value:[];return a?e.filter(e=>e.nombre.toLowerCase().includes(a)||e.email.toLowerCase().includes(a)||e.rol.toLowerCase().includes(a)):e}),S=()=>{k.value=!k.value},L=async a=>{w.value=a;try{await f.delete(`/usuarios/${a}`),h.value=h.value.filter(e=>e.id!==a),alert("Usuario eliminado exitosamente")}catch(e){console.error("Error al eliminar usuario:",e);alert(e?.response?.data?.message||"Error al eliminar el usuario")}finally{w.value=null}};return(a,e)=>{const l=o("v-expansion-panel-title"),r=o("v-card"),g=o("v-expansion-panel-text"),f=o("v-expansion-panel"),x=o("v-expansion-panels"),B=o("v-icon"),F=o("v-btn"),N=o("v-data-table");return t(),s(p,null,[k.value?(t(),i(x,{key:0,class:"mb-4"},{default:c(()=>[u(f,null,{default:c(()=>[u(l,null,{default:c(()=>[...e[0]||(e[0]=[d(" 🔍 Debug Info - Respuesta de la API ",-1)])]),_:1}),u(g,null,{default:c(()=>[u(r,{class:"pa-3",color:"grey-lighten-5"},{default:c(()=>[e[3]||(e[3]=m("div",null,[m("strong",null,"URL:"),d(" /usuarios")],-1)),m("div",null,[e[1]||(e[1]=m("strong",null,"Items cargados:",-1)),d(" "+v(h.value.length),1)]),m("div",null,[e[2]||(e[2]=m("strong",null,"Tipo de items:",-1)),d(" "+v(Array.isArray(h.value)?"Array":typeof h.value),1)]),e[4]||(e[4]=m("div",null,[m("strong",null,"Debug Info:")],-1)),m("pre",y,v(E.value),1)]),_:1})]),_:1})]),_:1})]),_:1})):n("",!0),u(N,{items:I.value,headers:U,loading:A.value,class:"elevation-1"},{"item.created_at":c(({item:a})=>[d(v(D(a.created_at)),1)]),"item.actions":c(({item:a})=>[m("div",b,[u(F,{size:"small",color:"primary",variant:"outlined",onClick:e=>{return l=a.id,void(window.location.href=`/usuarios/${l}/editar`);var l}},{default:c(()=>[u(B,{size:"small"},{default:c(()=>[...e[5]||(e[5]=[d("mdi-pencil",-1)])]),_:1}),e[6]||(e[6]=d(" Editar ",-1))]),_:2},1032,["onClick"]),C.value?(t(),i(F,{key:0,size:"small",color:"error",variant:"outlined",onClick:e=>(async a=>{if(!C.value)return void alert("No tienes permisos para eliminar usuarios");confirm(`¿Estás seguro de que deseas eliminar al usuario "${a.nombre}"?\n\nEsta acción no se puede deshacer.`)&&await L(a.id)})(a),loading:w.value===a.id},{default:c(()=>[u(B,{size:"small"},{default:c(()=>[...e[7]||(e[7]=[d("mdi-delete",-1)])]),_:1}),e[8]||(e[8]=d(" Eliminar ",-1))]),_:2},1032,["onClick","loading"])):n("",!0)])]),"no-data":c(()=>[m("div",_,[e[9]||(e[9]=m("div",null,"No hay usuarios para mostrar.",-1)),u(F,{size:"small",color:"primary",variant:"outlined",class:"mt-2",onClick:S},{default:c(()=>[d(v(k.value?"Ocultar":"Mostrar")+" Debug Info ",1)]),_:1})])]),_:1},8,["items","loading"])],64)}}}),A={class:"text-caption"},w=a({__name:"HomeView",setup(a){const s=g(),n=e(""),p=e(null);r(()=>{const a=localStorage.getItem("user");p.value=a?JSON.parse(a):null});const y=l(()=>"admin"===p.value?.rol),b=()=>s.push("/usuarios/nuevo"),_=()=>s.push("/tareas"),w=async()=>{try{await f.post("/logout")}catch(a){console.warn("Error al hacer logout en el servidor:",a)}finally{localStorage.removeItem("token"),localStorage.removeItem("user"),s.push("/login")}};return(a,e)=>{const l=o("v-btn"),r=o("v-text-field"),s=o("v-divider"),g=o("v-card"),f=o("v-col"),k=o("v-row"),E=o("v-container");return t(),i(E,{fluid:""},{default:c(()=>[u(k,null,{default:c(()=>[u(f,{cols:"12",md:"3"},{default:c(()=>[u(g,{class:"pa-4"},{default:c(()=>[e[5]||(e[5]=m("div",{class:"text-subtitle-1 mb-2"},"Acciones",-1)),u(l,{block:"",color:"primary",class:"mb-3",disabled:!y.value,onClick:b},{default:c(()=>[...e[1]||(e[1]=[d(" Agregar usuario ",-1)])]),_:1},8,["disabled"]),u(r,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),label:"Buscar usuarios","prepend-inner-icon":"mdi-magnify",density:"comfortable",clearable:"",class:"mb-4"},null,8,["modelValue"]),u(l,{block:"",color:"info",variant:"tonal",class:"mb-3",onClick:_},{default:c(()=>[...e[2]||(e[2]=[d(" Ver Tareas ",-1)])]),_:1}),u(l,{block:"",color:"error",variant:"tonal",onClick:w},{default:c(()=>[...e[3]||(e[3]=[d(" Cerrar sesión ",-1)])]),_:1}),u(s,{class:"my-4"}),m("div",A,[e[4]||(e[4]=d(" Sesión: ",-1)),m("strong",null,v(p.value?.nombre),1),d(" ("+v(p.value?.rol)+") ",1)])]),_:1})]),_:1}),u(f,{cols:"12",md:"9"},{default:c(()=>[u(g,{class:"pa-4"},{default:c(()=>[e[6]||(e[6]=m("div",{class:"text-h6 mb-4"},"Usuarios",-1)),u(h,{"search-term":n.value},null,8,["search-term"])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{w as default};
