import{d as a,r as e,j as r,b as l,k as s,u as o,c as u,w as t,a as i,e as d,i as n,t as c,g as m,o as v}from"./index-BWoXKDPb.js";import{a as p}from"./api-C_yQvIhj.js";const f=a({__name:"TaskForm",setup(a){const f=o(),y=l(),_=e(),g=e(!1),b=e(!1),V=e(!1),h=e({titulo:"",descripcion:"",estado:"pendiente",usuario_id:null,fecha_vencimiento:""}),q=e([]),A=[{title:"Pendiente",value:"pendiente"},{title:"En Progreso",value:"en_progreso"},{title:"Completada",value:"completada"}],E=r(()=>(Array.isArray(q.value)?q.value:[]).map(a=>({title:`${a.nombre} (${a.email})`,value:a.id}))),T={required:a=>!!a||"Este campo es requerido"},k=r(()=>!!y.params.id),U=async()=>{if(g.value){b.value=!0;try{k.value?await p.put(`/tareas/${y.params.id}`,h.value):await p.post("/tareas",h.value),f.push("/tareas")}catch(a){console.error("Error al guardar tarea:",a);if(alert(a?.response?.data?.message||"Error al guardar la tarea"),403===a?.response?.status)return}finally{b.value=!1}}},w=()=>{f.push("/tareas")};return s(async()=>{if(await(async()=>{V.value=!0;try{const a=await p.get("/usuarios");console.log("ðŸ” DEBUG TaskForm - Respuesta usuarios:",a),console.log("ðŸ” DEBUG TaskForm - Datos usuarios:",a.data),console.log("ðŸ” DEBUG TaskForm - Es array?",Array.isArray(a.data));let e=[];const r=a.data;Array.isArray(r)?e=r:r&&Array.isArray(r.data)?e=r.data:r&&Array.isArray(r.users)?e=r.users:(console.warn("âš ï¸ TaskForm - Formato de usuarios no reconocido:",r),e=[]),console.log("ðŸŽ¯ TaskForm - Usuarios para selector:",e),q.value=e}catch(a){console.error("âŒ TaskForm - Error al cargar usuarios:",a),q.value=[]}finally{V.value=!1}})(),k.value)try{const{data:a}=await p.get(`/tareas/${y.params.id}`);h.value={titulo:a.titulo,descripcion:a.descripcion,estado:a.estado,usuario_id:a.usuario_id,fecha_vencimiento:a.fecha_vencimiento?a.fecha_vencimiento.split("T")[0]:""}}catch(a){console.error("Error al cargar tarea:",a),f.push("/tareas")}}),(a,e)=>{const r=i("v-card-title"),l=i("v-text-field"),s=i("v-textarea"),o=i("v-select"),p=i("v-btn"),f=i("v-spacer"),y=i("v-card-actions"),q=i("v-form"),F=i("v-card"),x=i("v-col"),C=i("v-row"),D=i("v-container");return v(),u(D,null,{default:t(()=>[d(C,{justify:"center"},{default:t(()=>[d(x,{cols:"12",md:"8"},{default:t(()=>[d(F,{class:"pa-6"},{default:t(()=>[d(r,{class:"text-h5 mb-4"},{default:t(()=>[n(c(k.value?"Editar Tarea":"Crear Nueva Tarea"),1)]),_:1}),d(q,{ref_key:"form",ref:_,modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),onSubmit:m(U,["prevent"])},{default:t(()=>[d(l,{modelValue:h.value.titulo,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value.titulo=a),label:"TÃ­tulo de la tarea",rules:[T.required],required:"",variant:"outlined",class:"mb-3"},null,8,["modelValue","rules"]),d(s,{modelValue:h.value.descripcion,"onUpdate:modelValue":e[1]||(e[1]=a=>h.value.descripcion=a),label:"DescripciÃ³n",rules:[T.required],required:"",variant:"outlined",rows:"3",class:"mb-3"},null,8,["modelValue","rules"]),d(o,{modelValue:h.value.estado,"onUpdate:modelValue":e[2]||(e[2]=a=>h.value.estado=a),label:"Estado",items:A,rules:[T.required],required:"",variant:"outlined",class:"mb-3"},null,8,["modelValue","rules"]),d(o,{modelValue:h.value.usuario_id,"onUpdate:modelValue":e[3]||(e[3]=a=>h.value.usuario_id=a),label:"Asignar a usuario",items:E.value,rules:[T.required],loading:V.value,required:"",variant:"outlined",class:"mb-3"},null,8,["modelValue","items","rules","loading"]),d(l,{modelValue:h.value.fecha_vencimiento,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value.fecha_vencimiento=a),label:"Fecha de vencimiento",type:"date",rules:[T.required],required:"",variant:"outlined",class:"mb-4"},null,8,["modelValue","rules"]),d(y,{class:"px-0"},{default:t(()=>[d(p,{color:"grey",variant:"outlined",onClick:w},{default:t(()=>[...e[6]||(e[6]=[n(" Cancelar ",-1)])]),_:1}),d(f),d(p,{color:"primary",type:"submit",loading:b.value,disabled:!g.value},{default:t(()=>[n(c(k.value?"Actualizar":"Crear")+" Tarea ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{f as default};
