import{d as e,r as a,j as l,b as r,k as u,u as s,c as o,w as t,a as i,e as d,i as n,t as m,g as v,o as c}from"./index-BWoXKDPb.js";import{a as p}from"./api-C_yQvIhj.js";const b=e({__name:"UserForm",setup(e){const b=s(),f=r(),V=a(),g=a(!1),w=a(!1),h=a({nombre:"",email:"",password:"",rol:"usuario"}),_=[{title:"Usuario",value:"usuario"},{title:"Administrador",value:"admin"}],q={required:e=>!!e||"Este campo es requerido",email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)||"Debe ser un email válido",minLength:e=>e.length>=6||"Mínimo 6 caracteres"},y=l(()=>!!f.params.id),U=async()=>{if(g.value){w.value=!0;try{if(y.value){const e={nombre:h.value.nombre,email:h.value.email,rol:h.value.rol};h.value.password&&(e.password=h.value.password),await p.put(`/usuarios/${f.params.id}`,e)}else await p.post("/usuarios",h.value);b.push("/usuarios")}catch(e){console.error("Error al guardar usuario:",e);if(alert(e?.response?.data?.message||"Error al guardar el usuario"),403===e?.response?.status)return}finally{w.value=!1}}},j=()=>{b.push("/usuarios")};return u(async()=>{if(y.value)try{const{data:e}=await p.get(`/usuarios/${f.params.id}`);h.value={nombre:e.nombre,email:e.email,password:"",rol:e.rol}}catch(e){console.error("Error al cargar usuario:",e),b.push("/usuarios")}}),(e,a)=>{const l=i("v-card-title"),r=i("v-text-field"),u=i("v-select"),s=i("v-btn"),p=i("v-spacer"),b=i("v-card-actions"),f=i("v-form"),x=i("v-card"),C=i("v-col"),E=i("v-row"),k=i("v-container");return c(),o(k,null,{default:t(()=>[d(E,{justify:"center"},{default:t(()=>[d(C,{cols:"12",md:"6"},{default:t(()=>[d(x,{class:"pa-6"},{default:t(()=>[d(l,{class:"text-h5 mb-4"},{default:t(()=>[n(m(y.value?"Editar Usuario":"Agregar Nuevo Usuario"),1)]),_:1}),d(f,{ref_key:"form",ref:V,modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=e=>g.value=e),onSubmit:v(U,["prevent"])},{default:t(()=>[d(r,{modelValue:h.value.nombre,"onUpdate:modelValue":a[0]||(a[0]=e=>h.value.nombre=e),label:"Nombre completo",rules:[q.required],required:"",variant:"outlined",class:"mb-3"},null,8,["modelValue","rules"]),d(r,{modelValue:h.value.email,"onUpdate:modelValue":a[1]||(a[1]=e=>h.value.email=e),label:"Correo electrónico",rules:[q.required,q.email],required:"",variant:"outlined",class:"mb-3"},null,8,["modelValue","rules"]),d(r,{modelValue:h.value.password,"onUpdate:modelValue":a[2]||(a[2]=e=>h.value.password=e),label:"Contraseña",type:"password",rules:y.value?[]:[q.required,q.minLength],required:!y.value,variant:"outlined",class:"mb-3",hint:y.value?"Deja en blanco para mantener la contraseña actual":"","persistent-hint":""},null,8,["modelValue","rules","required","hint"]),d(u,{modelValue:h.value.rol,"onUpdate:modelValue":a[3]||(a[3]=e=>h.value.rol=e),label:"Rol",items:_,rules:[q.required],required:"",variant:"outlined",class:"mb-4"},null,8,["modelValue","rules"]),d(b,{class:"px-0"},{default:t(()=>[d(s,{color:"grey",variant:"outlined",onClick:j},{default:t(()=>[...a[5]||(a[5]=[n(" Cancelar ",-1)])]),_:1}),d(p),d(s,{color:"primary",type:"submit",loading:w.value,disabled:!g.value},{default:t(()=>[n(m(y.value?"Actualizar":"Crear")+" Usuario ",1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{b as default};
